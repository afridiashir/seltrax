

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String          @id @default(uuid())
  name      String
  email     String          @unique
  password  String
  createdAt DateTime        @default(now())
  stores    UserStoreRole[] // Relation to stores via roles
}

model Store {
  id         String          @id @default(uuid())
  ownerId    String
  name       String
  category   String?
  logoUrl    String?
  siteIcon   String?
  mainDomain String?
  currency   String          @default("Rs")
  createdAt  DateTime        @default(now())
  users      UserStoreRole[] // Relation to users via roles
  customers  Customer[]
  domains    Domain[]
  shippingRate  ShippingRate[]
  taxRules      TaxRules[] 
  paymentMethods paymentMethods[]
  coupons       Coupons[]
}

model UserStoreRole {
  id      String @id @default(uuid())
  userId  String
  storeId String
  role    Role

  user  User  @relation(fields: [userId], references: [id])
  store Store @relation(fields: [storeId], references: [id])

  @@unique([userId, storeId]) // a user can have only one role per store
}

enum Role {
  OWNER
  ADMIN
  STAFF
}

// Customers

model Customer {
  id        String   @id @default(uuid())
  storeId   String
  firstName String
  lastName  String
  email     String
  phone     String?
  address   String?
  state     String?
  city      String?
  country   String?
  zipCode   String?
  createdAt DateTime @default(now())

  store Store @relation(fields: [storeId], references: [id])

  @@unique([storeId, phone])
}

// Domains

model Domain {
  id          String       @id @default(uuid())
  storeId     String
  domain      String       @unique
  isPrimary   Boolean      @default(false)
  status      DomainStatus @default(PENDING) // e.g., pending, verified
  lastChecked DateTime?
  createdAt   DateTime     @default(now())

  store Store @relation(fields: [storeId], references: [id])
}

enum DomainStatus {
  PENDING
  VERIFIED
  ACTIVE
  FAILED
}

// Shipping Options 

model ShippingRate {
  id      String @id @default(uuid())
  storeId String

  name  String 
  price Float // price for this rate (0 if free)

  minOrderPrice Float? // e.g., free above 5000
  maxOrderPrice Float? // optional

  minWeight Float? // for weight-based shipping (optional)
  maxWeight Float? // optional

  estimatedDeliveryDays Int? // optional

  createdAt DateTime @default(now())

  store Store @relation(fields: [storeId], references: [id])
}

model TaxRules {
  id        String  @id @default(uuid())
  storeId   String
  name      String
  percentage Float?
  fixedAmount   Float?
  createdAt DateTime @default(now())

  store Store @relation(fields: [storeId], references: [id])
}

model paymentMethods {
  id        String  @id @default(uuid())
  storeId   String
  name      String
  description String?
  details   Json?
  createdAt DateTime @default(now())

  store Store @relation(fields: [storeId], references: [id])
}

model Coupons {
  id       String   @id @default(uuid())
  storeId   String
  code      String   @unique
  discount  Float    // e.g., percentage or fixed amount
  type      CouponType   // e.g., percentage, fixed
  minOrderValue Float? // minimum order value to apply coupon
  maxDiscount Float? // maximum discount limit
  startDate DateTime?
  endDate   DateTime?
  usageLimit Int? // maximum times this coupon can be used
  usedCount Int @default(0) // how many times this coupon has been used
  isActive  Boolean @default(true) // whether the coupon is active


  createdAt DateTime @default(now())
  store Store @relation(fields: [storeId], references: [id])

  
  @@unique([storeId, code])
}

enum CouponType {
  PERCENTAGE
  FIXED
}
